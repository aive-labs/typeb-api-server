2024-07-23 13:25:43 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:26:46 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:27:31 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:34:57 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:37:57 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:37:57 - INFO - BEGIN (implicit)
2024-07-23 13:37:57 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:37:57 - INFO - [generated in 0.00061s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x138e23ed0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:37:57 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:37:57 - INFO - [generated in 0.00040s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:37:57 - INFO - ROLLBACK
2024-07-23 13:37:57 - INFO - ROLLBACK
2024-07-23 13:38:42 - INFO - BEGIN (implicit)
2024-07-23 13:38:42 - INFO - SELECT aivelabs_sv.users.user_id AS aivelabs_sv_users_user_id, aivelabs_sv.users.username AS aivelabs_sv_users_username, aivelabs_sv.users.role_id AS aivelabs_sv_users_role_id, aivelabs_sv.users.photo_uri AS aivelabs_sv_users_photo_uri, aivelabs_sv.users.department_id AS aivelabs_sv_users_department_id, aivelabs_sv.users.email AS aivelabs_sv_users_email, aivelabs_sv.users.language AS aivelabs_sv_users_language, aivelabs_sv.users.last_login AS aivelabs_sv_users_last_login, aivelabs_sv.users.created_at AS aivelabs_sv_users_created_at, aivelabs_sv.users.updated_at AS aivelabs_sv_users_updated_at, aivelabs_sv.users.login_id AS aivelabs_sv_users_login_id, aivelabs_sv.users.erp_id AS aivelabs_sv_users_erp_id, aivelabs_sv.users.sys_id AS aivelabs_sv_users_sys_id, aivelabs_sv.users.boan_admin AS aivelabs_sv_users_boan_admin, aivelabs_sv.users.gw_position_cd AS aivelabs_sv_users_gw_position_cd, aivelabs_sv.users.gw_position_nm AS aivelabs_sv_users_gw_position_nm, aivelabs_sv.users.department_name AS aivelabs_sv_users_department_name, aivelabs_sv.users.department_abb_name AS aivelabs_sv_users_department_abb_name, aivelabs_sv.users.test_callback_number AS aivelabs_sv_users_test_callback_number, aivelabs_sv.users.cell_phone_number AS aivelabs_sv_users_cell_phone_number, aivelabs_sv.users.messenger_comment AS aivelabs_sv_users_messenger_comment, aivelabs_sv.users.branch_manager AS aivelabs_sv_users_branch_manager, aivelabs_sv.users.parent_dept_cd AS aivelabs_sv_users_parent_dept_cd, aivelabs_sv.user_passwords.login_pw AS aivelabs_sv_user_passwords_login_pw
FROM aivelabs_sv.users JOIN aivelabs_sv.user_passwords ON aivelabs_sv.users.login_id = aivelabs_sv.user_passwords.login_id
WHERE aivelabs_sv.users.email = %(email_1)s
 LIMIT %(param_1)s
2024-07-23 13:38:42 - INFO - [cached since 45.11s ago] {'email_1': 'aivelabs', 'param_1': 1}
2024-07-23 13:38:42 - INFO - SELECT aivelabs_sv.cafe24_integration.user_id AS aivelabs_sv_cafe24_integration_user_id, aivelabs_sv.cafe24_integration.mall_id AS aivelabs_sv_cafe24_integration_mall_id, aivelabs_sv.cafe24_integration.state_token AS aivelabs_sv_cafe24_integration_state_token, aivelabs_sv.cafe24_integration.access_token AS aivelabs_sv_cafe24_integration_access_token, aivelabs_sv.cafe24_integration.access_token_expired_at AS aivelabs_sv_cafe24_integration_access_token_expired_at, aivelabs_sv.cafe24_integration.refresh_token AS aivelabs_sv_cafe24_integration_refresh_token, aivelabs_sv.cafe24_integration.refresh_token_expired_at AS aivelabs_sv_cafe24_integration_refresh_token_expired_at, aivelabs_sv.cafe24_integration.scopes AS aivelabs_sv_cafe24_integration_scopes, aivelabs_sv.cafe24_integration.shop_no AS aivelabs_sv_cafe24_integration_shop_no, aivelabs_sv.cafe24_integration.cafe24_user_id AS aivelabs_sv_cafe24_integration_cafe24_user_id, aivelabs_sv.cafe24_integration.data_migration_status AS aivelabs_sv_cafe24_integration_data_migration_status, aivelabs_sv.cafe24_integration.created_at AS aivelabs_sv_cafe24_integration_created_at, aivelabs_sv.cafe24_integration.updated_at AS aivelabs_sv_cafe24_integration_updated_at
FROM aivelabs_sv.cafe24_integration
WHERE aivelabs_sv.cafe24_integration.user_id = %(user_id_1)s
2024-07-23 13:38:42 - INFO - [cached since 45.11s ago] {'user_id_1': '10'}
2024-07-23 13:38:42 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:38:42 - INFO - BEGIN (implicit)
2024-07-23 13:38:42 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:38:42 - INFO - [cached since 45.18s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x138e7be50>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:38:42 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:38:42 - INFO - [cached since 45.17s ago] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:38:42 - INFO - ROLLBACK
2024-07-23 13:38:42 - INFO - ROLLBACK
2024-07-23 13:42:18 - INFO - BEGIN (implicit)
2024-07-23 13:42:18 - INFO - SELECT aivelabs_sv.users.user_id AS aivelabs_sv_users_user_id, aivelabs_sv.users.username AS aivelabs_sv_users_username, aivelabs_sv.users.role_id AS aivelabs_sv_users_role_id, aivelabs_sv.users.photo_uri AS aivelabs_sv_users_photo_uri, aivelabs_sv.users.department_id AS aivelabs_sv_users_department_id, aivelabs_sv.users.email AS aivelabs_sv_users_email, aivelabs_sv.users.language AS aivelabs_sv_users_language, aivelabs_sv.users.last_login AS aivelabs_sv_users_last_login, aivelabs_sv.users.created_at AS aivelabs_sv_users_created_at, aivelabs_sv.users.updated_at AS aivelabs_sv_users_updated_at, aivelabs_sv.users.login_id AS aivelabs_sv_users_login_id, aivelabs_sv.users.erp_id AS aivelabs_sv_users_erp_id, aivelabs_sv.users.sys_id AS aivelabs_sv_users_sys_id, aivelabs_sv.users.boan_admin AS aivelabs_sv_users_boan_admin, aivelabs_sv.users.gw_position_cd AS aivelabs_sv_users_gw_position_cd, aivelabs_sv.users.gw_position_nm AS aivelabs_sv_users_gw_position_nm, aivelabs_sv.users.department_name AS aivelabs_sv_users_department_name, aivelabs_sv.users.department_abb_name AS aivelabs_sv_users_department_abb_name, aivelabs_sv.users.test_callback_number AS aivelabs_sv_users_test_callback_number, aivelabs_sv.users.cell_phone_number AS aivelabs_sv_users_cell_phone_number, aivelabs_sv.users.messenger_comment AS aivelabs_sv_users_messenger_comment, aivelabs_sv.users.branch_manager AS aivelabs_sv_users_branch_manager, aivelabs_sv.users.parent_dept_cd AS aivelabs_sv_users_parent_dept_cd, aivelabs_sv.user_passwords.login_pw AS aivelabs_sv_user_passwords_login_pw
FROM aivelabs_sv.users JOIN aivelabs_sv.user_passwords ON aivelabs_sv.users.login_id = aivelabs_sv.user_passwords.login_id
WHERE aivelabs_sv.users.email = %(email_1)s
 LIMIT %(param_1)s
2024-07-23 13:42:18 - INFO - [cached since 261.3s ago] {'email_1': 'aivelabs', 'param_1': 1}
2024-07-23 13:42:18 - INFO - SELECT aivelabs_sv.cafe24_integration.user_id AS aivelabs_sv_cafe24_integration_user_id, aivelabs_sv.cafe24_integration.mall_id AS aivelabs_sv_cafe24_integration_mall_id, aivelabs_sv.cafe24_integration.state_token AS aivelabs_sv_cafe24_integration_state_token, aivelabs_sv.cafe24_integration.access_token AS aivelabs_sv_cafe24_integration_access_token, aivelabs_sv.cafe24_integration.access_token_expired_at AS aivelabs_sv_cafe24_integration_access_token_expired_at, aivelabs_sv.cafe24_integration.refresh_token AS aivelabs_sv_cafe24_integration_refresh_token, aivelabs_sv.cafe24_integration.refresh_token_expired_at AS aivelabs_sv_cafe24_integration_refresh_token_expired_at, aivelabs_sv.cafe24_integration.scopes AS aivelabs_sv_cafe24_integration_scopes, aivelabs_sv.cafe24_integration.shop_no AS aivelabs_sv_cafe24_integration_shop_no, aivelabs_sv.cafe24_integration.cafe24_user_id AS aivelabs_sv_cafe24_integration_cafe24_user_id, aivelabs_sv.cafe24_integration.data_migration_status AS aivelabs_sv_cafe24_integration_data_migration_status, aivelabs_sv.cafe24_integration.created_at AS aivelabs_sv_cafe24_integration_created_at, aivelabs_sv.cafe24_integration.updated_at AS aivelabs_sv_cafe24_integration_updated_at
FROM aivelabs_sv.cafe24_integration
WHERE aivelabs_sv.cafe24_integration.user_id = %(user_id_1)s
2024-07-23 13:42:18 - INFO - [cached since 261.3s ago] {'user_id_1': '10'}
2024-07-23 13:42:18 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:42:18 - INFO - BEGIN (implicit)
2024-07-23 13:42:18 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:42:18 - INFO - [cached since 261.3s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x139011910>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:42:18 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:42:18 - INFO - [cached since 261.3s ago] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:42:18 - INFO - ROLLBACK
2024-07-23 13:42:18 - INFO - BEGIN (implicit)
2024-07-23 13:42:18 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:42:18 - INFO - [cached since 261.3s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13901cdd0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:42:18 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:42:18 - INFO - [generated in 0.00030s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:42:18 - INFO - ROLLBACK
2024-07-23 13:42:18 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:42:18 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:42:18 - INFO - BEGIN (implicit)
2024-07-23 13:42:18 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:42:18 - INFO - [cached since 261.4s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x139018450>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:42:18 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:42:18 - INFO - [generated in 0.00024s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:42:18 - INFO - ROLLBACK
2024-07-23 13:42:18 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:42:18 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:42:18 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:42:18 - INFO - [generated in 0.00029s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:42:18 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:42:18 - INFO - [generated in 0.00029s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:42:18.790611+09:00', 'send_rslt_date': '2024-07-23T13:42:18.790775+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:42:18.790775+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:42:18.790775+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:42:18 - INFO - COMMIT
2024-07-23 13:44:20 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:44:20 - INFO - BEGIN (implicit)
2024-07-23 13:44:20 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:44:20 - INFO - [generated in 0.00034s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a00ac10>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:44:20 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:44:20 - INFO - [generated in 0.00038s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:44:20 - INFO - ROLLBACK
2024-07-23 13:44:20 - INFO - BEGIN (implicit)
2024-07-23 13:44:20 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:44:20 - INFO - [cached since 0.1882s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a05e0d0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:44:20 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:44:20 - INFO - [generated in 0.00035s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:44:20 - INFO - ROLLBACK
2024-07-23 13:44:20 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:44:20 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:44:20 - INFO - BEGIN (implicit)
2024-07-23 13:44:20 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:44:20 - INFO - [cached since 0.2319s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x139f8db50>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:44:20 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:44:20 - INFO - [generated in 0.00026s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:44:20 - INFO - ROLLBACK
2024-07-23 13:44:20 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:44:20 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:44:20 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:44:20 - INFO - [generated in 0.00025s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:44:20 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:44:20 - INFO - [generated in 0.00026s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:44:20.499704+09:00', 'send_rslt_date': '2024-07-23T13:44:20.499920+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:44:20.499920+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:44:20.499920+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:44:20 - INFO - COMMIT
2024-07-23 13:45:01 - INFO - BEGIN (implicit)
2024-07-23 13:45:01 - INFO - SELECT aivelabs_sv.users.user_id AS aivelabs_sv_users_user_id, aivelabs_sv.users.username AS aivelabs_sv_users_username, aivelabs_sv.users.role_id AS aivelabs_sv_users_role_id, aivelabs_sv.users.photo_uri AS aivelabs_sv_users_photo_uri, aivelabs_sv.users.department_id AS aivelabs_sv_users_department_id, aivelabs_sv.users.email AS aivelabs_sv_users_email, aivelabs_sv.users.language AS aivelabs_sv_users_language, aivelabs_sv.users.last_login AS aivelabs_sv_users_last_login, aivelabs_sv.users.created_at AS aivelabs_sv_users_created_at, aivelabs_sv.users.updated_at AS aivelabs_sv_users_updated_at, aivelabs_sv.users.login_id AS aivelabs_sv_users_login_id, aivelabs_sv.users.erp_id AS aivelabs_sv_users_erp_id, aivelabs_sv.users.sys_id AS aivelabs_sv_users_sys_id, aivelabs_sv.users.boan_admin AS aivelabs_sv_users_boan_admin, aivelabs_sv.users.gw_position_cd AS aivelabs_sv_users_gw_position_cd, aivelabs_sv.users.gw_position_nm AS aivelabs_sv_users_gw_position_nm, aivelabs_sv.users.department_name AS aivelabs_sv_users_department_name, aivelabs_sv.users.department_abb_name AS aivelabs_sv_users_department_abb_name, aivelabs_sv.users.test_callback_number AS aivelabs_sv_users_test_callback_number, aivelabs_sv.users.cell_phone_number AS aivelabs_sv_users_cell_phone_number, aivelabs_sv.users.messenger_comment AS aivelabs_sv_users_messenger_comment, aivelabs_sv.users.branch_manager AS aivelabs_sv_users_branch_manager, aivelabs_sv.users.parent_dept_cd AS aivelabs_sv_users_parent_dept_cd, aivelabs_sv.user_passwords.login_pw AS aivelabs_sv_user_passwords_login_pw
FROM aivelabs_sv.users JOIN aivelabs_sv.user_passwords ON aivelabs_sv.users.login_id = aivelabs_sv.user_passwords.login_id
WHERE aivelabs_sv.users.email = %(email_1)s
 LIMIT %(param_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.27s ago] {'email_1': 'aivelabs', 'param_1': 1}
2024-07-23 13:45:01 - INFO - SELECT aivelabs_sv.cafe24_integration.user_id AS aivelabs_sv_cafe24_integration_user_id, aivelabs_sv.cafe24_integration.mall_id AS aivelabs_sv_cafe24_integration_mall_id, aivelabs_sv.cafe24_integration.state_token AS aivelabs_sv_cafe24_integration_state_token, aivelabs_sv.cafe24_integration.access_token AS aivelabs_sv_cafe24_integration_access_token, aivelabs_sv.cafe24_integration.access_token_expired_at AS aivelabs_sv_cafe24_integration_access_token_expired_at, aivelabs_sv.cafe24_integration.refresh_token AS aivelabs_sv_cafe24_integration_refresh_token, aivelabs_sv.cafe24_integration.refresh_token_expired_at AS aivelabs_sv_cafe24_integration_refresh_token_expired_at, aivelabs_sv.cafe24_integration.scopes AS aivelabs_sv_cafe24_integration_scopes, aivelabs_sv.cafe24_integration.shop_no AS aivelabs_sv_cafe24_integration_shop_no, aivelabs_sv.cafe24_integration.cafe24_user_id AS aivelabs_sv_cafe24_integration_cafe24_user_id, aivelabs_sv.cafe24_integration.data_migration_status AS aivelabs_sv_cafe24_integration_data_migration_status, aivelabs_sv.cafe24_integration.created_at AS aivelabs_sv_cafe24_integration_created_at, aivelabs_sv.cafe24_integration.updated_at AS aivelabs_sv_cafe24_integration_updated_at
FROM aivelabs_sv.cafe24_integration
WHERE aivelabs_sv.cafe24_integration.user_id = %(user_id_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.27s ago] {'user_id_1': '10'}
2024-07-23 13:45:01 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:45:01 - INFO - BEGIN (implicit)
2024-07-23 13:45:01 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.2s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a1bfe90>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:01 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.18s ago] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:45:01 - INFO - ROLLBACK
2024-07-23 13:45:01 - INFO - BEGIN (implicit)
2024-07-23 13:45:01 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.26s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a1bf810>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:01 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:45:01 - INFO - [cached since 41.07s ago] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:45:01 - INFO - ROLLBACK
2024-07-23 13:45:01 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:45:01 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:45:01 - INFO - BEGIN (implicit)
2024-07-23 13:45:01 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.29s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a05d890>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:01 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:45:01 - INFO - [cached since 41.06s ago] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:45:01 - INFO - ROLLBACK
2024-07-23 13:45:01 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:45:01 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:45:01 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:45:01 - INFO - [cached since 41.06s ago] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:45:01 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:45:01 - INFO - [cached since 41.05s ago] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:45:01.561304+09:00', 'send_rslt_date': '2024-07-23T13:45:01.561463+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:45:01.561463+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:45:01.561463+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:45:01 - INFO - COMMIT
2024-07-23 13:45:22 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:45:22 - INFO - BEGIN (implicit)
2024-07-23 13:45:22 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:22 - INFO - [generated in 0.00044s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x1352e71d0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:22 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:45:22 - INFO - [generated in 0.00039s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:45:22 - INFO - ROLLBACK
2024-07-23 13:45:22 - INFO - BEGIN (implicit)
2024-07-23 13:45:22 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:22 - INFO - [cached since 0.1821s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13533af90>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:22 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:45:22 - INFO - [generated in 0.00026s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:45:22 - INFO - ROLLBACK
2024-07-23 13:45:22 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:45:22 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:45:22 - INFO - BEGIN (implicit)
2024-07-23 13:45:22 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:22 - INFO - [cached since 0.2318s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x1352f3b50>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:22 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:45:22 - INFO - [generated in 0.00027s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:45:22 - INFO - ROLLBACK
2024-07-23 13:45:22 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:45:22 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:45:22 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:45:22 - INFO - [generated in 0.00025s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:45:22 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:45:22 - INFO - [generated in 0.00031s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:45:22.814167+09:00', 'send_rslt_date': '2024-07-23T13:45:22.814370+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:45:22.814370+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:45:22.814370+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:45:22 - INFO - COMMIT
2024-07-23 13:45:48 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:45:49 - INFO - BEGIN (implicit)
2024-07-23 13:45:49 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:49 - INFO - [generated in 0.00037s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a7cb310>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:49 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:45:49 - INFO - [generated in 0.00037s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:45:49 - INFO - ROLLBACK
2024-07-23 13:45:49 - INFO - BEGIN (implicit)
2024-07-23 13:45:49 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:49 - INFO - [cached since 0.1828s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a81e2d0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:49 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:45:49 - INFO - [generated in 0.00027s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:45:49 - INFO - ROLLBACK
2024-07-23 13:45:49 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:45:49 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:45:49 - INFO - BEGIN (implicit)
2024-07-23 13:45:49 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:45:49 - INFO - [cached since 0.2181s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13a839290>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:45:49 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:45:49 - INFO - [generated in 0.00022s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:45:49 - INFO - ROLLBACK
2024-07-23 13:45:49 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:45:49 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:45:49 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:45:49 - INFO - [generated in 0.00023s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:45:49 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:45:49 - INFO - [generated in 0.00028s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:45:49.345358+09:00', 'send_rslt_date': '2024-07-23T13:45:49.345596+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:45:49.345596+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:45:49.345596+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:45:49 - INFO - COMMIT
2024-07-23 13:46:26 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:46:26 - INFO - BEGIN (implicit)
2024-07-23 13:46:26 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:46:26 - INFO - [generated in 0.00042s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x12fc8b250>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:46:26 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:46:26 - INFO - [generated in 0.00053s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:46:26 - INFO - ROLLBACK
2024-07-23 13:46:26 - INFO - BEGIN (implicit)
2024-07-23 13:46:26 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:46:26 - INFO - [cached since 0.1806s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x12fce2250>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:46:26 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:46:26 - INFO - [generated in 0.00027s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:46:26 - INFO - ROLLBACK
2024-07-23 13:46:26 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:46:26 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:46:26 - INFO - BEGIN (implicit)
2024-07-23 13:46:26 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:46:26 - INFO - [cached since 0.2195s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x12fce1dd0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:46:26 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:46:26 - INFO - [generated in 0.00037s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:46:26 - INFO - ROLLBACK
2024-07-23 13:46:26 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:46:26 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:46:26 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:46:26 - INFO - [generated in 0.00025s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:46:26 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:46:26 - INFO - [generated in 0.00036s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:46:26.829607+09:00', 'send_rslt_date': '2024-07-23T13:46:26.829795+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:46:26.829795+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:46:26.829795+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:46:26 - INFO - COMMIT
2024-07-23 13:47:33 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:47:34 - INFO - BEGIN (implicit)
2024-07-23 13:47:34 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:47:34 - INFO - [generated in 0.00033s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x131877890>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:47:34 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:47:34 - INFO - [generated in 0.00035s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:47:34 - INFO - ROLLBACK
2024-07-23 13:47:34 - INFO - BEGIN (implicit)
2024-07-23 13:47:34 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:47:34 - INFO - [cached since 0.1861s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x1318d1ed0>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:47:34 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:47:34 - INFO - [generated in 0.00027s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:47:34 - INFO - ROLLBACK
2024-07-23 13:47:34 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:47:34 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:47:34 - INFO - BEGIN (implicit)
2024-07-23 13:47:34 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:47:34 - INFO - [cached since 0.2218s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x13151b190>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:47:34 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:47:34 - INFO - [generated in 0.00033s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:47:34 - INFO - ROLLBACK
2024-07-23 13:47:34 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:47:34 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:47:34 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:47:34 - INFO - [generated in 0.00025s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:47:34 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:47:34 - INFO - [generated in 0.00028s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:47:34.288388+09:00', 'send_rslt_date': '2024-07-23T13:47:34.288568+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:47:34.288568+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:47:34.288568+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:47:34 - INFO - COMMIT
2024-07-23 13:48:47 - INFO - 1.[Test] campaign_id: cam-000043
2024-07-23 13:48:47 - INFO - BEGIN (implicit)
2024-07-23 13:48:47 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:48:47 - INFO - [generated in 0.00053s] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x1397c2f50>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:48:47 - INFO - SELECT aivelabs_sv.campaign_set_recipients.campaign_id, aivelabs_sv.campaign_set_recipients.set_sort_num, aivelabs_sv.campaign_set_recipients.group_sort_num, aivelabs_sv.campaign_set_recipients.cus_cd, aivelabs_sv.campaign_set_recipients.contents_id, aivelabs_sv.campaign_set_recipients.rep_nm, aivelabs_sv.contents.contents_name, aivelabs_sv.contents.contents_url, anon_1.shop_send_yn, anon_1.set_group_msg_seq, anon_1.campaign_name, anon_1.audience_id, anon_1.start_date AS campaign_start_date, anon_1.end_date AS campaign_end_date, anon_1.offer_amount AS offer_amount, anon_1.event_str_dt AS offer_start_date, anon_1.event_end_dt AS offer_end_date, anon_1.msg_resv_date AS send_resv_date, anon_1.timetosend, aivelabs_sv.customer_master.hp_no AS phone_send, anon_1.msg_delivery_vendor AS send_sv_type, anon_1.msg_type AS send_msg_type, anon_1.msg_send_type AS msg_category, anon_1.remind_step, anon_1.msg_title AS send_msg_subject, anon_1.msg_body AS send_msg_body, anon_1.bottom_text, anon_1.phone_callback, anon_1.msg_announcement, anon_1.template_key AS kko_template_key
FROM aivelabs_sv.campaign_set_recipients JOIN (SELECT aivelabs_sv.campaigns.campaign_group_id AS campaign_group_id, aivelabs_sv.campaigns.campaign_id AS campaign_id, aivelabs_sv.campaigns.campaign_name AS campaign_name, aivelabs_sv.campaigns.shop_send_yn AS shop_send_yn, to_char(to_date(aivelabs_sv.campaigns.start_date, %(to_date_1)s), %(to_char_1)s) AS start_date, to_char(to_date(aivelabs_sv.campaigns.end_date, %(to_date_2)s), %(to_char_2)s) AS end_date, aivelabs_sv.campaigns.msg_delivery_vendor AS msg_delivery_vendor, aivelabs_sv.campaigns.timetosend AS timetosend, aivelabs_sv.campaign_sets.audience_id AS audience_id, aivelabs_sv.campaign_sets.coupon_no AS coupon_no, aivelabs_sv.set_group_messages.set_group_msg_seq AS set_group_msg_seq, aivelabs_sv.campaign_set_groups.set_sort_num AS set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num AS group_sort_num, aivelabs_sv.offers.coupon_no AS coupon_no_1, coalesce(aivelabs_sv.offers.benefit_price, aivelabs_sv.offers.benefit_percentage) AS offer_amount, to_char(to_date(aivelabs_sv.offers.available_begin_datetime, %(to_date_3)s), %(to_char_3)s) AS event_str_dt, to_char(to_date(aivelabs_sv.offers.available_end_datetime, %(to_date_4)s), %(to_char_4)s) AS event_end_dt, aivelabs_sv.set_group_messages.media AS media, aivelabs_sv.set_group_messages.msg_type AS msg_type, aivelabs_sv.set_group_messages.msg_send_type AS msg_send_type, aivelabs_sv.set_group_messages.msg_title AS msg_title, aivelabs_sv.set_group_messages.msg_body AS msg_body, aivelabs_sv.set_group_messages.msg_gen_key AS msg_gen_key, aivelabs_sv.set_group_messages.msg_photo_uri AS msg_photo_uri, aivelabs_sv.set_group_messages.msg_announcement AS msg_announcement, aivelabs_sv.set_group_messages.phone_callback AS phone_callback, aivelabs_sv.set_group_messages.bottom_text AS bottom_text, aivelabs_sv.set_group_messages.msg_resv_date AS msg_resv_date, aivelabs_sv.set_group_messages.template_id AS template_id, aivelabs_sv.message_templates.template_key AS template_key, aivelabs_sv.set_group_messages.remind_seq AS remind_seq, aivelabs_sv.set_group_messages.remind_step AS remind_step, aivelabs_sv.set_group_messages.is_used AS is_used
FROM aivelabs_sv.campaigns JOIN aivelabs_sv.campaign_sets ON aivelabs_sv.campaigns.campaign_id = aivelabs_sv.campaign_sets.campaign_id JOIN aivelabs_sv.campaign_set_groups ON aivelabs_sv.campaign_sets.set_seq = aivelabs_sv.campaign_set_groups.set_seq JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq LEFT OUTER JOIN aivelabs_sv.message_templates ON aivelabs_sv.set_group_messages.template_id = aivelabs_sv.message_templates.template_id LEFT OUTER JOIN aivelabs_sv.offers ON aivelabs_sv.campaign_sets.coupon_no = aivelabs_sv.offers.coupon_no
WHERE aivelabs_sv.campaign_sets.campaign_id = %(campaign_id_1)s AND aivelabs_sv.set_group_messages.is_used IS true AND aivelabs_sv.set_group_messages.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s)) AS anon_1 ON aivelabs_sv.campaign_set_recipients.campaign_id = anon_1.campaign_id AND aivelabs_sv.campaign_set_recipients.set_sort_num = anon_1.set_sort_num AND aivelabs_sv.campaign_set_recipients.group_sort_num = anon_1.group_sort_num JOIN aivelabs_sv.customer_master ON aivelabs_sv.campaign_set_recipients.cus_cd = aivelabs_sv.customer_master.cus_cd LEFT OUTER JOIN aivelabs_sv.contents ON aivelabs_sv.campaign_set_recipients.contents_id = aivelabs_sv.contents.contents_id
WHERE aivelabs_sv.customer_master.hp_no != %(hp_no_1)s AND anon_1.msg_body != %(msg_body_1)s
2024-07-23 13:48:47 - INFO - [generated in 0.00036s] {'to_date_1': 'YYYYMMDD', 'to_char_1': 'YYYY-MM-DD', 'to_date_2': 'YYYYMMDD', 'to_char_2': 'YYYY-MM-DD', 'to_date_3': 'YYYYMMDD', 'to_char_3': 'YYYY-MM-DD', 'to_date_4': 'YYYYMMDD', 'to_char_4': 'YYYY-MM-DD', 'campaign_id_1': 'cam-000043', 'hp_no_1': '', 'msg_body_1': '', 'set_group_msg_seq_1_1': 75}
2024-07-23 13:48:47 - INFO - ROLLBACK
2024-07-23 13:48:47 - INFO - BEGIN (implicit)
2024-07-23 13:48:47 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:48:47 - INFO - [cached since 0.1879s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x139816b90>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:48:47 - INFO - SELECT DISTINCT aivelabs_sv.set_group_messages.set_group_msg_seq, aivelabs_sv.campaign_set_groups.campaign_id, aivelabs_sv.campaign_set_groups.set_sort_num, aivelabs_sv.campaign_set_groups.group_sort_num, aivelabs_sv.kakao_link_buttons.kakao_link_buttons_seq, aivelabs_sv.kakao_link_buttons.set_group_msg_seq AS set_group_msg_seq_1, aivelabs_sv.kakao_link_buttons.button_name, aivelabs_sv.kakao_link_buttons.button_type, aivelabs_sv.kakao_link_buttons.web_link, aivelabs_sv.kakao_link_buttons.app_link, aivelabs_sv.kakao_link_buttons.created_at, aivelabs_sv.kakao_link_buttons.created_by, aivelabs_sv.kakao_link_buttons.updated_at, aivelabs_sv.kakao_link_buttons.updated_by
FROM aivelabs_sv.campaign_set_groups JOIN aivelabs_sv.set_group_messages ON aivelabs_sv.campaign_set_groups.set_group_seq = aivelabs_sv.set_group_messages.set_group_seq JOIN aivelabs_sv.kakao_link_buttons ON aivelabs_sv.set_group_messages.set_group_msg_seq = aivelabs_sv.kakao_link_buttons.set_group_msg_seq
WHERE aivelabs_sv.kakao_link_buttons.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s)
2024-07-23 13:48:47 - INFO - [generated in 0.00023s] {'set_group_msg_seq_2_1': 75}
2024-07-23 13:48:47 - INFO - ROLLBACK
2024-07-23 13:48:47 - INFO - 2.[Test] button 개인화 적용 전 row수 :1
2024-07-23 13:48:47 - INFO - 3.[Test] button 개인화 적용 후 row수 :1
2024-07-23 13:48:47 - INFO - BEGIN (implicit)
2024-07-23 13:48:47 - INFO - SELECT pg_catalog.pg_class.relname
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2024-07-23 13:48:47 - INFO - [cached since 0.2254s ago] {'table_name': <sqlalchemy.sql.selectable.Select object at 0x139817410>, 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2024-07-23 13:48:47 - INFO - SELECT anon_1.set_group_msg_seq, anon_1.send_filepath, anon_1.send_filecount
FROM (SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.link_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.link_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_1_1)s) AND aivelabs_sv.message_image_resources.link_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq UNION SELECT aivelabs_sv.message_image_resources.set_group_msg_seq AS set_group_msg_seq, array_agg(aivelabs_sv.message_image_resources.landing_url) AS send_filepath, cardinality(array_agg(aivelabs_sv.message_image_resources.landing_url)) AS send_filecount
FROM aivelabs_sv.message_image_resources
WHERE aivelabs_sv.message_image_resources.set_group_msg_seq IN (%(set_group_msg_seq_2_1)s) AND aivelabs_sv.message_image_resources.landing_url IS NOT NULL GROUP BY aivelabs_sv.message_image_resources.set_group_msg_seq) AS anon_1
2024-07-23 13:48:47 - INFO - [generated in 0.00021s] {'set_group_msg_seq_1_1': 75, 'set_group_msg_seq_2_1': 75}
2024-07-23 13:48:47 - INFO - ROLLBACK
2024-07-23 13:48:47 - INFO - 4.[Test] send_msg_body 개인화 적용 후 row수 :1
2024-07-23 13:48:47 - INFO - 5.[Test] phone_callback 개인화 적용 후 row수 :1
2024-07-23 13:48:47 - INFO - SELECT aivelabs_sv.campaigns.campaign_id AS aivelabs_sv_campaigns_campaign_id, aivelabs_sv.campaigns.campaign_name AS aivelabs_sv_campaigns_campaign_name, aivelabs_sv.campaigns.campaign_group_id AS aivelabs_sv_campaigns_campaign_group_id, aivelabs_sv.campaigns.budget AS aivelabs_sv_campaigns_budget, aivelabs_sv.campaigns.campaign_type_code AS aivelabs_sv_campaigns_campaign_type_code, aivelabs_sv.campaigns.campaign_type_name AS aivelabs_sv_campaigns_campaign_type_name, aivelabs_sv.campaigns.medias AS aivelabs_sv_campaigns_medias, aivelabs_sv.campaigns.campaign_status_group_code AS aivelabs_sv_campaigns_campaign_status_group_code, aivelabs_sv.campaigns.campaign_status_group_name AS aivelabs_sv_campaigns_campaign_status_group_name, aivelabs_sv.campaigns.campaign_status_code AS aivelabs_sv_campaigns_campaign_status_code, aivelabs_sv.campaigns.campaign_status_name AS aivelabs_sv_campaigns_campaign_status_name, aivelabs_sv.campaigns.send_type_code AS aivelabs_sv_campaigns_send_type_code, aivelabs_sv.campaigns.send_type_name AS aivelabs_sv_campaigns_send_type_name, aivelabs_sv.campaigns.repeat_type AS aivelabs_sv_campaigns_repeat_type, aivelabs_sv.campaigns.week_days AS aivelabs_sv_campaigns_week_days, aivelabs_sv.campaigns.send_date AS aivelabs_sv_campaigns_send_date, aivelabs_sv.campaigns.is_msg_creation_recurred AS aivelabs_sv_campaigns_is_msg_creation_recurred, aivelabs_sv.campaigns.is_approval_recurred AS aivelabs_sv_campaigns_is_approval_recurred, aivelabs_sv.campaigns.datetosend AS aivelabs_sv_campaigns_datetosend, aivelabs_sv.campaigns.timetosend AS aivelabs_sv_campaigns_timetosend, aivelabs_sv.campaigns.start_date AS aivelabs_sv_campaigns_start_date, aivelabs_sv.campaigns.end_date AS aivelabs_sv_campaigns_end_date, aivelabs_sv.campaigns.group_end_date AS aivelabs_sv_campaigns_group_end_date, aivelabs_sv.campaigns.has_remind AS aivelabs_sv_campaigns_has_remind, aivelabs_sv.campaigns.campaigns_exc AS aivelabs_sv_campaigns_campaigns_exc, aivelabs_sv.campaigns.audiences_exc AS aivelabs_sv_campaigns_audiences_exc, aivelabs_sv.campaigns.strategy_id AS aivelabs_sv_campaigns_strategy_id, aivelabs_sv.campaigns.strategy_theme_ids AS aivelabs_sv_campaigns_strategy_theme_ids, aivelabs_sv.campaigns.is_personalized AS aivelabs_sv_campaigns_is_personalized, aivelabs_sv.campaigns.progress AS aivelabs_sv_campaigns_progress, aivelabs_sv.campaigns.msg_delivery_vendor AS aivelabs_sv_campaigns_msg_delivery_vendor, aivelabs_sv.campaigns.shop_send_yn AS aivelabs_sv_campaigns_shop_send_yn, aivelabs_sv.campaigns.retention_day AS aivelabs_sv_campaigns_retention_day, aivelabs_sv.campaigns.owned_by_dept AS aivelabs_sv_campaigns_owned_by_dept, aivelabs_sv.campaigns.owned_by_dept_name AS aivelabs_sv_campaigns_owned_by_dept_name, aivelabs_sv.campaigns.owned_by_dept_abb_name AS aivelabs_sv_campaigns_owned_by_dept_abb_name, aivelabs_sv.campaigns.created_at AS aivelabs_sv_campaigns_created_at, aivelabs_sv.campaigns.created_by AS aivelabs_sv_campaigns_created_by, aivelabs_sv.campaigns.created_by_name AS aivelabs_sv_campaigns_created_by_name, aivelabs_sv.campaigns.updated_at AS aivelabs_sv_campaigns_updated_at, aivelabs_sv.campaigns.updated_by AS aivelabs_sv_campaigns_updated_by
FROM aivelabs_sv.campaigns
WHERE aivelabs_sv.campaigns.campaign_id = %(campaign_id_1)s
 LIMIT %(param_1)s
2024-07-23 13:48:47 - INFO - [generated in 0.00040s] {'campaign_id_1': 'cam-000043', 'param_1': 1}
2024-07-23 13:48:47 - INFO - INSERT INTO aivelabs_sv.send_reservation (set_group_msg_seq, campaign_id, campaign_name, send_resv_date, send_rslt_date, phone_send, phone_callback, send_sv_type, send_msg_type, send_msg_subject, send_msg_body, send_filecount, kko_ssg_retry, msg_category, sent_success, shop_send_yn, test_send_yn, audience_id, create_resv_date, create_resv_user, update_resv_date, update_resv_user) VALUES (%(set_group_msg_seq)s, %(campaign_id)s, %(campaign_name)s, %(send_resv_date)s, %(send_rslt_date)s, %(phone_send)s, %(phone_callback)s, %(send_sv_type)s, %(send_msg_type)s, %(send_msg_subject)s, %(send_msg_body)s, %(send_filecount)s, %(kko_ssg_retry)s, %(msg_category)s, %(sent_success)s, %(shop_send_yn)s, %(test_send_yn)s, %(audience_id)s, %(create_resv_date)s, %(create_resv_user)s, %(update_resv_date)s, %(update_resv_user)s) RETURNING aivelabs_sv.send_reservation.send_resv_seq
2024-07-23 13:48:47 - INFO - [generated in 0.00030s] {'set_group_msg_seq': 75, 'campaign_id': 'cam-000043', 'campaign_name': 'expert 캠페인 테스트 333', 'send_resv_date': '2024-07-23T13:48:47.732645+09:00', 'send_rslt_date': '2024-07-23T13:48:47.732810+09:00', 'phone_send': '0220885502', 'phone_callback': '02-2088-5502', 'send_sv_type': 'ssg', 'send_msg_type': 'sms', 'send_msg_subject': 'test', 'send_msg_body': 'test\n\n무료수신거부 080-801-7860', 'send_filecount': 0, 'kko_ssg_retry': 0, 'msg_category': 'campaign', 'sent_success': 'n', 'shop_send_yn': 'n', 'test_send_yn': 'y', 'audience_id': 'aud-010182', 'create_resv_date': '2024-07-23T13:48:47.732810+09:00', 'create_resv_user': 'test-user', 'update_resv_date': '2024-07-23T13:48:47.732810+09:00', 'update_resv_user': 'test-user'}
2024-07-23 13:48:47 - INFO - COMMIT
